# #3566583: Add Field Widget Actions (FWA) support for text-to-image media generation on the media_library_widget for core Image media

- **Project:** Drupal AI
- **Type:** Normal feature request
- **Version:** 1.3.x-dev
- **Status:** Fixed
- **Diff:** [239ad1f](https://git.drupalcode.org/project/ai/-/commit/239ad1f202aadd5a57bcd7e8df932477b93e6ec8) · +526/-8 prod · +504/-0 test · 12 files
- **Discussion:** [#3566583](https://www.drupal.org/node/3566583) · 7 contributors · 30 comments

## Summary

Content editors can now generate AI images on demand while editing. A new button in the Media Library widget lets editors create images from text prompts without leaving the content form. The generated image becomes a media entity automatically attached to the field. This makes it faster to illustrate articles with AI-generated visuals during the writing process.

## Impact

No upgrade or configuration changes required.

## Technical details

This change adds a new Field Widget Action plugin `TextToImageMediaLibrary` that integrates the text-to-image automator workflow with the `media_library_widget`. When editors click the action button, the plugin invokes the configured AI automator to generate an image from a text prompt, creates a Media entity of type Image, and updates the widget selection via AJAX commands.

The plugin implements `isAvailable()` to check that the field references media entities with image bundles. It overrides `singleElementFormAlter()` to hide the button when the field has reached its cardinality limit. The `aiAutomatorsAjax()` method handles the button click by calling `populateAutomatorValues()`, then uses `InvokeCommand` to update the hidden selection field and trigger the Media Library update button to refresh the display.

The `TextToMediaImage` automator base class was updated to make the Media Type field required and moved to the top of the form with improved help text. Documentation was added at `docs/modules/ai_automators/examples/text_to_image_media_automator.md` explaining configuration steps. A kernel test `TextToImageMediaFieldWidgetProcessingTest` verifies both the field widget action path and direct save processing path create media entities correctly.

## Timeline

- Opened: January 9, 2026
- Committed: February 16, 2026 (1 month later)

## Collaboration

fago authored comprehensive documentation with step-by-step configuration instructions and testing guidance, including screenshots showing before and after image generation. They also fixed multiple usability issues during review: moving the media type field to a prominent position, implementing the missing `isAvailable()` method, hiding the button when cardinality limits are reached, and adding test coverage. a.dmitriiev requested documentation improvements that led to these enhancements, then successfully merged the feature to both the 1.3.x and 2.0.x branches after adjusting tests for the new automator structure. annmarysruthy provided early manual testing confirmation that the feature worked as expected.

## Lessons learned

- When adding action buttons to widgets with cardinality limits, only show the button when the field can accept more items. Showing disabled actions that trigger validation errors creates a poor user experience; instead, users can remove an existing item before adding a new one. *(via fago)*
- When implementing a feature that requires complex configuration, provide documentation with concrete examples showing the main configuration steps. Screenshots and example values help users understand how to connect multiple components (like automators, field widgets, and entity context) without trial and error. *(via a.dmitriiev, fago)*
- When generating media entities programmatically, required fields like alt text may be left empty. Document this limitation and suggest configuring additional automators to populate required fields, preventing validation issues downstream. *(via fago)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3566583) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
