# #3566582: Add Field Widget Actions (FWA) support for llm_media_audio_generation on the media_library_widget

- **Project:** Drupal AI
- **Type:** Normal feature request
- **Version:** 1.3.x-dev
- **Status:** Fixed
- **Diff:** [8ea07a4](https://git.drupalcode.org/project/ai/-/commit/8ea07a47df8ae97ac8729a46bc5224cf5da537a6) 路 +394/-0 路 5 files
- **Discussion:** [#3566582](https://www.drupal.org/node/3566582) 路 5 contributors 路 20 comments

## Summary

The AI module now supports generating audio media directly from content editing forms. When editing content with a media field configured for audio, editors can click a button to convert text into speech using AI providers like OpenAI. The generated audio file is automatically saved as a media entity and attached to the content. This makes it easier to create audio versions of articles, podcasts, or accessibility features without leaving the edit form.

## Impact

No upgrade or configuration changes required.

## Technical details

This change adds the `TextToAudioMediaLibrary` field widget action plugin for the `media_library_widget`. The plugin works with the existing `llm_media_audio_generation` automator to create audio media entities from text content.

The `isAvailable()` method checks that the field references media entities and that at least one of the allowed media bundles uses the `audio_file` source plugin. This prevents the action button from appearing on fields configured for other media types like images.

The `aiAutomatorsAjax()` method handles the AJAX interaction. It calls `populateAutomatorValues()` to trigger the audio generation, then uses `InvokeCommand` to update the media library widget's hidden selection field and trigger the update button via `mousedown`. This integrates the generated media into the widget without requiring a full form rebuild.

The `saveFormValues()` method collects the target IDs from the media reference field items and stores them in a custom form property so the AJAX handler can access them.

A companion fix in the `field_widget_actions` module ensures the field definition is passed to action plugins during both complete form and single element alterations. This allows plugins like `TextToAudioMediaLibrary` to inspect field settings in `isAvailable()`.

New documentation in `docs/modules/ai_automators/text_to_audio_media_automator.md` explains how to configure the automator with base mode (using a single text field as input) or advanced token mode (composing input from multiple fields). It covers prerequisites like configuring an AI provider with speech generation support and selecting the correct media type during field configuration.

## Timeline

- Opened: January 9, 2026
- Committed: February 11, 2026 (1 month later)

## Collaboration

anjaliprasannan implemented the feature plugin and documentation. prabha1997 provided testing and caught an important edge case where the audio action appeared on fields configured only for image media. a.dmitriiev reviewed the implementation, requested the documentation to help users configure complex automator prompts and context settings, and identified a related issue in the standalone field_widget_actions module that needed fixing.

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3566582) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
