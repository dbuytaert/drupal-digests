# #3566582: Add Field Widget Actions (FWA) support for llm_media_audio_generation on the media_library_widget

- **Project:** Drupal AI
- **Type:** Normal feature request
- **Version:** 1.3.x-dev
- **Status:** Fixed
- **Diff:** [8ea07a4](https://git.drupalcode.org/project/ai/-/commit/8ea07a47df8ae97ac8729a46bc5224cf5da537a6) 路 +394/-0 路 5 files
- **Discussion:** [#3566582](https://www.drupal.org/node/3566582) 路 5 contributors 路 19 comments

## Summary

Content editors can now generate audio files from text while editing content directly within the media field widget. When a media field is configured with an AI Automator for audio generation, a button appears in the widget that triggers text-to-speech conversion. The generated audio file is automatically saved as a media entity and attached to the field. This streamlines workflows for creating audio versions of articles, accessibility features, or podcasts from written content without leaving the editing form.

## Impact

No upgrade or configuration changes required.

## Technical details

The AI Automators module adds a new Field Widget Action plugin `TextToAudioMediaLibrary` that works with the core `media_library_widget`. This plugin extends `AutomatorBaseAction` and is restricted to `entity_reference` fields targeting media entities.

The `isAvailable()` method checks whether the referenced field allows audio media bundles by examining the field's target bundles and comparing them against media types with the `audio_file` source plugin. This prevents the action from appearing on fields that cannot accept audio media.

The `aiAutomatorsAjax()` method handles the button click by calling `populateAutomatorValues()` to generate the audio media entity, then uses Ajax commands to update the media library widget's hidden selection field and programmatically trigger the widget's update button. This integration pattern ensures the newly created media entity appears in the widget without a full page reload.

A companion fix in the `field_widget_actions` module's `FieldWidgetAction` hook class now passes the field definition to action plugins via `setFieldDefinition()` during both `hook_field_widget_complete_form_alter()` and `hook_field_widget_single_element_form_alter()`. This allows plugins to inspect field configuration when determining availability.

Documentation in `text_to_audio_media_automator.md` covers setup for both base mode (using a single text field as input) and advanced mode (using tokens), including prompt examples and testing steps.

## Timeline

- Opened: January 9, 2026
- Committed: February 11, 2026 (1 month later)

## Collaboration

Contributor a.dmitriiev requested documentation before merge, recognizing that AI automator configuration is complex for end users. Contributor anjaliprasannan responded by adding a comprehensive markdown guide with configuration steps, prompt examples, and testing instructions. The review also caught a bug in the standalone `field_widget_actions` module where field definitions weren't passed to plugins, which a.dmitriiev committed to fixing upstream. This pattern of asking for user-facing documentation before merging feature additions helps ensure new capabilities are actually usable.

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3566582) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
