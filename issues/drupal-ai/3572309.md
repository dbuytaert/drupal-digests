# #3572309: Saving AI Agent via the visual editor doesn't work 

- **Project:** Drupal AI
- **Type:** Major bug report
- **Version:** 1.3.x-dev
- **Status:** Fixed
- **Diff:** [29cd1dc](https://git.drupalcode.org/project/ai_agents/-/commit/29cd1dc9b7491cfe6f048a2fa0914ad49bcada46) 路 +15/-22 路 1 file
- **Discussion:** [#3572309](https://www.drupal.org/node/3572309) 路 6 contributors 路 16 comments

## Summary

A bug prevented AI Agent configuration changes from being saved when using the visual editor. When users edited tool settings in the sidebar panel and saved the workflow, their changes would not persist. Reloading the page would show the old values. This issue affected any modeler using the Modeler API to save AI Agents, making the visual editor unreliable for configuring agent behavior.

## Impact

No upgrade or configuration changes required.

## Technical details

The bug was in `Agent::addComponent()` and `Agent::addComponent()` methods in the ai_agents module. The code hardcoded only specific behavioral settings like `return_directly`, `require_usage`, `use_artifacts`, and `progress_message` when mapping between the modeler component config and the agent's internal storage. Any other settings from contrib modules were silently dropped during save.

The component config contains two types of keys. Keys with triple underscores like `url___action` represent property restrictions stored in `tool_usage_limits`. Keys without triple underscores like `description_override` represent behavioral settings stored in `tool_settings`. The old code only saved the four hardcoded behavioral settings.

The fix changes the logic to split config generically based on whether keys contain triple underscores. Keys with `___` go to `tool_usage_limits` as property restrictions. Keys without `___` go to `tool_settings` as behavioral settings. This approach is future-proof because contrib modules can now add new behavioral settings without core code changes.

## Timeline

- Opened: February 9, 2026
- Committed: February 16, 2026 (6 days later)

## Collaboration

Ahmad Khader diagnosed the root cause in the ai_agents module and provided the fix that splits configuration keys generically based on the triple underscore pattern. d34dman tested the patch and confirmed that agent configuration now persists correctly after save. hrishikesh-dalal created the initial fork to address the issue.

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3572309) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
