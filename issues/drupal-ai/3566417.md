# #3566417: Extend Media Library with description and tag filters

- **Project:** Drupal AI
- **Type:** Normal feature request
- **Version:** 1.x-dev
- **Status:** Fixed
- **Diff:** [9adf1a8](https://git.drupalcode.org/project/ai_recipe_image_classification/-/commit/9adf1a85f4cf59181652255c853431e41b5c16c4) 路 +220/-2 路 4 files
- **Discussion:** [#3566417](https://www.drupal.org/node/3566417) 路 4 contributors 路 17 comments

## Summary

The AI Recipe Image Classification now adds search filters to the Media Library, making it easier to find images by their AI-generated descriptions and classification tags. When selecting images in the media library widget or browsing the media overview page, editors can now search by description text or filter by taxonomy tags that were automatically generated by AI. This improves the usability of large media libraries where images have been enriched with AI-generated metadata.

## Impact

Affects site owners.

- **Requirements:** Minimum Drupal core version raised from 10.4/11.x to 11.2

## Technical details

The recipe now uses the `setProperties` config action to add two exposed filters to both the `media` and `media_library` views. The first filter searches the `field_image_description` text field using the `string` plugin with an `allwords` operator. The second filter uses the `taxonomy_index_tid` plugin to filter by terms in the `field_image_tags` taxonomy reference field, configured as a multiple-select textfield.

Both filters are added to all relevant displays: the default display, page display, widget display, and widget_table display of the `media_library` view. YAML anchors (`&filter_description` and `&filter_tags`) are used to avoid repeating the filter configuration across multiple displays.

The implementation relies on the `setProperties` config action introduced in Drupal 11.2, which allows recipes to modify nested configuration properties on configuration entities. Earlier approaches were considered but rejected: `simpleConfigUpdate` is deprecated for config entities, `set`/`SetMultiple` actions don't support nested paths, and there are no dedicated config actions for views filters yet. The minimum core version requirement was raised from 10.4/11.x to 11.2 to ensure `setProperties` is available.

## Upgrade

Sites using this recipe must upgrade to Drupal 11.2 or later before updating to version 2.0.0 of the AI Recipe Image Classification. The filters are automatically added when the recipe is applied; no manual configuration is needed.

## Timeline

- Opened: January 8, 2026
- Committed: February 12, 2026 (1 month later)

## Collaboration

a.dmitriiev opened the feature request to improve media library search. fago implemented the solution, evaluating multiple config action approaches before settling on `setProperties` as the most maintainable option despite the increased version requirement.

## Lessons learned

- When a recipe needs to modify existing configuration that may already be installed by another recipe or distribution, use config actions like setProperties rather than importing config files. Config file imports only work on fresh installs when the recipe runs first, but config actions can update existing configuration on sites where earlier recipes have already installed it. *(via fago)*
- When using config actions to modify nested configuration like Views filters, prefer setProperties over set/SetMultiple. The set/SetMultiple actions don't support nested paths, requiring you to duplicate and re-set large portions of configuration, which creates maintenance burden. *(via fago)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3566417) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
