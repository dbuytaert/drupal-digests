# #3488114: Add support for rerank operation type

- **Project:** Drupal AI
- **Type:** Normal feature request
- **Version:** 2.0.x-dev
- **Status:** Fixed
- **Diff:** [684f90d](https://git.drupalcode.org/project/ai/-/commit/684f90d9cf14e11b2d140b4c023f417b509eaf77) · +555/-6 prod · +4/-0 infra · 12 files
- **Discussion:** [#3488114](https://www.drupal.org/node/3488114) · 10 contributors · 43 comments

## Summary

AI providers can now offer document re-ranking, a technique that refines search results after the initial retrieval. Re-ranking uses specialized algorithms or large language models to reorder results based on relevance to a query. This is particularly valuable for semantic search and vector database queries where the first pass retrieves many candidates but needs a second pass to identify the most relevant matches. For example, when searching thousands of images or documents, re-ranking can significantly improve result quality by applying more sophisticated relevance scoring to the top candidates.

## Impact

Affects module maintainers.

- **New API:** New `rerank` operation type for improving search result quality using AI-powered re-ranking algorithms

## Technical details

The AI module now defines a new `rerank` operation type alongside existing types like chat, embedding, and moderation. Providers implement the `ReRankInterface` which requires a `rerank()` method accepting `ReRankInput` and returning `ReRankOutput`.

The `ReRankInput` class encapsulates a query string, an array of inputs to rerank (documents, text chunks, images), an optional `topN` parameter to limit results, and a metadata array for tracking context. The class provides getters and setters for all properties. The `ReRankOutput` class contains the reranked results array, a request ID, and metadata.

Configuration schema was extended with a `rerank` section under `ai.settings.default_providers` following the same pattern as other operation types. This allows administrators to select a default provider and model for re-ranking operations at `/admin/config/ai/settings`.

The implementation is operation-type based because different providers offer different re-ranking capabilities: some like Cohere have dedicated re-ranking endpoints, while others can implement re-ranking by prompting a general-purpose LLM. The AI Search module can optionally integrate this as a Search API processor to automatically rerank search results before display.

## Timeline

- Opened: November 18, 2024
- Committed: February 10, 2026 (1 year later)

## Collaboration

This feature request remained open for over a year before gxleano revived it, coordinating implementation across three related issues in the AI module, AI Search, and Cohere provider. nikro provided crucial validation by implementing a working re-ranker with LiteLLM proxying TogetherAI, demonstrating the API worked across different provider architectures. The team prioritized getting this into the 1.3.x release, accelerating review cycles. The testing approach—requiring cross-module integration to validate—highlighted the value of having concrete provider implementations during API design reviews rather than reviewing abstractions in isolation.

## Lessons learned

- When building a multi-step information retrieval system, processing happens in distinct phases with different capabilities. Re-ranking is a second-pass refinement operation that takes initial retrieval results and reorders them for relevance, requiring both the original query and the candidate documents as inputs. *(via lussoluca)*
- When adding new operation types to a plugin system, validate the design by implementing at least one concrete provider before merging. Testing with real implementations reveals whether the abstraction provides sufficient context and whether the interface needs adjustment. *(via scott_euser, nikro)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3488114) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
