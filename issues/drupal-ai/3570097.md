# #3570097: Create a build script for MDXEditor with mentions

- **Project:** Drupal AI
- **Type:** Normal feature request
- **Version:** 1.3.0-beta1
- **Status:** Fixed
- **Diff:** [e7fce84](https://git.drupalcode.org/project/ai/-/commit/e7fce84c75e0598ee3308fcfc1b7d389906daae0) · +5666/-446 prod · +28/-4 test · +293/-140 infra · 460 files
- **Discussion:** [#3570097](https://www.drupal.org/node/3570097) · 5 contributors · 39 comments

## Summary

The AI module now includes a rich text editor with autocomplete support for tokens and custom context variables in prompt fields. This makes it easier to author prompts across the module by providing visual formatting tools and smart suggestions when typing `[` for tokens or `{` for context variables. The editor automatically enhances textareas in prompt forms without breaking older browsers.

## Impact

No upgrade or configuration changes required.

## Technical details

The AI module integrated MDXEditor with the `@mdxeditor/typeahead-plugin` to create a rich prompt authoring experience. A new `js_builds/mdxeditor` folder contains a Vite-based build pipeline that compiles the editor into `mdxeditor/dist`. The build is configured in `.gitlab-ci.yml` to run on every commit (with artifacts cached for tests) but the built files are kept in `.gitignore` to avoid repository bloat.

When creating a release tag, maintainers must now run `scripts/tag-release.sh`, which temporarily forces the built files into the commit, creates the tag, then removes them—mirroring the Canvas module's approach. The editor attaches to textareas with specific `data-mdxeditor` attributes and reads configuration from `drupalSettings.mdxeditor`, including available tokens and variables defined in each prompt type.

A new `Drupal\ai\Hook\FormElement` service and `ai.libraries.yml` entry for `mdx_editor` load the compiled JavaScript and CSS. The `AiPromptSubform` service was updated to expose editor configuration, and prompt form fields now render with the MDXEditor library attached. The build process uses Vite for both live reloading during development and production builds.

## Timeline

- Opened: January 28, 2026
- First commit: January 30, 2026 (2 days later)
- Last commit: February 16, 2026 (16 days later)

## Collaboration

Artem Dmitriev (a.dmitriiev) built the initial MDXEditor integration, exposed the editor configuration to `drupalSettings`, and fixed test issues. Bruno (bbruno) researched Canvas's build-on-tag approach and helped design the CI/CD workflow for handling the large built files without committing them on every push. Marcus Johansson shepherded the issue, provided the vibe-coded reference implementation, requested follow-up refinements for documentation and asset handling, and made the decision to merge quickly to unblock other work despite remaining follow-ups.

## Lessons learned

- When adding large built JavaScript artifacts to a project, exclude them from version control and build them only during tagged releases. This prevents repository bloat from repeated build changes while ensuring stable releases include all necessary assets. *(via marcus_johansson, a.dmitriiev, bbruno)*
- When integrating complex JavaScript components into forms, use data attributes on the original element to configure progressive enhancement. This allows the enhanced UI to fail gracefully to the original form element and enables configuration to be passed via server-side rendering. *(via a.dmitriiev)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3570097) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
