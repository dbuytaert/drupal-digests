# #3572310: Update the codebase to latest version of FlowDrop UI

- **Project:** Drupal AI
- **Type:** Major task
- **Version:** 1.0.x-dev
- **Status:** Fixed
- **Discussion:** [#3572310](https://www.drupal.org/node/3572310) · 4 contributors · 11 comments

## Summary

The FlowDrop module now uses the latest version of the FlowDrop UI library, which was extracted into a standalone project. This update removes custom workarounds that are no longer needed and adopts modern standards like proximity-based connection detection. The workflow editor now has better automatic layout spacing and prevents accidental connections when repositioning elements. Schema definitions now use standard JSON Schema patterns instead of custom enum formats.

## Impact

No upgrade or configuration changes required.

## Technical details

The FlowDrop UI library was externalized into a standalone project, and the Drupal module was updated to consume it as an external dependency. This required removing a local patch for category/weight sorting, which was moved server-side into the controller since FlowDrop UI now respects API-provided order.

Schema compatibility was improved by migrating all `enum`/`enumNames` pairs to the standard JSON Schema `oneOf` pattern using `const`/`title`, with backwards-compatible JavaScript rendering. Textarea fields now use `format = "multiline"` instead of custom approaches. CSS variables were updated to match those available in the latest FlowDrop UI version.

The custom drag-and-drop auto-attach system was replaced with FlowDrop's native proximity connect feature. This included updating sidebar agent definitions to include the `tools` output port for connection detection and adding a `/api/flowdrop-agents/categories` endpoint for sidebar grouping with category icon mapping. The proximity connect distance was reduced from 200px to 50px to prevent accidental connections during minor repositioning.

JavaScript was updated to use the correct FlowDrop API methods: `updateNode` instead of `updateNodePosition` and `updateEdges` instead of `addEdge`. Bidirectional mapping was added between FlowDrop's `instanceDescription` magic variable and Drupal's `description_override` field across the PHP loader, mapper, save controller, and workflow parser.

Layout spacing was significantly improved with vertical gap increased from 180px to 260px, column width from 300px to 350px, agent-to-tool offset from 350px to 500px, and agent gap from 80px to 100px. A staggered column layout was introduced where odd columns are offset by half the vertical spacing to prevent accidental port alignment. Tool position swaps during magnetic drag were fixed by sorting tools by stable ID index and adding a movement threshold above 2px.

## Timeline

- Opened: February 9, 2026

## Collaboration

d34dman led this modernization effort, updating the FlowDrop module to work with the externalized FlowDrop UI library and removing obsolete customizations. gxleano tested the changes and verified the workflow editor functionality.

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3572310) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
