# #3574824: When doing internal development, add cweagans/composer-patches to Package Manager's list of trusted plugins

- **Project:** Drupal CMS
- **Type:** Normal bug report
- **Status:** Fixed
- **Diff:** [5f64bc4](https://git.drupalcode.org/project/drupal_cms/-/commit/5f64bc4cfb2cf442ae795b810851a8a7ba3fb5de) 路 +198/-0 路 6 files
- **Discussion:** [#3574824](https://www.drupal.org/node/3574824) 路 2 contributors 路 11 comments

## Summary

Installing recipes in Drupal CMS development environments was failing with an error about an unsupported Composer plugin. The problem occurred because the `cweagans/composer-patches` plugin, used for internal development, was not on Package Manager's list of trusted plugins. This prevented developers from testing recipe installations in the main Drupal CMS development environment. The fix automatically trusts this plugin when running in the specific DDEV environment used for Drupal CMS core development, allowing recipe installations to proceed normally.

## Impact

No upgrade or configuration changes required.

## Technical details

Package Manager validates Composer plugins for security reasons and blocks untrusted plugins from running during package operations. Drupal CMS development uses `cweagans/composer-patches` as a development dependency, but this plugin was not on the trusted list, causing recipe installations to fail with a `SandboxException`.

The solution adds a new `InternalDevelopmentSubscriber` class to the `drupal_cms_helper` module. This class implements both `ConfigFactoryOverrideInterface` and `EventSubscriberInterface`. When the `DDEV_PROJECT` environment variable equals `drupal-cms-dev`, it overrides the `package_manager.settings` configuration to add `cweagans/composer-patches` to the `additional_trusted_composer_plugins` list.

The subscriber's `loadOverrides()` method reads the existing configuration, merges the patcher plugin into the trusted list, and returns the override. The `onBoot()` method also enables Package Manager's direct-write mode by setting the `package_manager_allow_direct_write` setting. This entire mechanism only activates in the specific DDEV environment used for Drupal CMS core development, so it does not affect production sites or other development environments.

## Timeline

- Opened: February 20, 2026
- Committed: February 20, 2026

## Collaboration

phenaproxima quickly diagnosed the root cause and implemented a targeted solution using environment-based config overrides. thejimbirch reported the issue and verified the fix through manual testing.

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3574824) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
