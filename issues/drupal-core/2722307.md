# #2722307: Move translation based conditions into database query on revisions overview page

- **Project:** Drupal Core
- **Type:** Normal bug report
- **Version:** 11.3.x-dev
- **Status:** Fixed
- **Diff:** [9367e55](https://git.drupalcode.org/project/drupal/-/commit/9367e55ded587cf761fcf24e46480f5eced0913d) · +294/-279 prod · +207/-30 test · 15 files
- **Discussion:** [#2722307](https://www.drupal.org/node/2722307) · 11 contributors · 57 comments

## Summary

The revision history page for content could show incorrect pagination or even appear empty when a node had many translation-related revisions. The page would load 50 revisions from the database but then filter them afterwards, sometimes leaving nothing to display. The revision page now filters revisions directly in the database query so pagination works correctly and always shows the appropriate revisions for the current language.

## Impact

No upgrade or configuration changes required.

## Technical details

The revision overview pages for nodes and other entities were loading revisions via a database query and then filtering them in PHP by checking `isRevisionTranslationAffected()`. This approach caused pagination problems because the pager would request 50 revisions from the database, but many could be filtered out afterwards, resulting in fewer revisions displayed than expected or even empty pages.

The fix moves the translation filtering logic into the database queries themselves. Both `NodeController::getRevisionIds()` and `VersionHistoryController::loadRevisions()` now add conditions for `langcode` and `revision_translation_affected` directly to the entity query before pagination is applied. This ensures the pager works correctly because it only counts revisions that will actually be displayed.

The changes remove the nested conditionals that checked `hasTranslation()` and `isRevisionTranslationAffected()` after loading revisions. These checks are now redundant because the database query already filters to affected revisions for the current language. The code is also simplified by removing unnecessary indentation levels in `NodeController::revisionOverview()`.

Test coverage was added to verify that creating many non-affecting revisions does not break pagination, and that the pager correctly splits affected revisions across multiple pages.

## Timeline

- Opened: May 10, 2016
- First commit: February 13, 2026 (9 years later)
- Last commit: February 15, 2026 (2 days later)

## Collaboration

Adam Bramley drove this issue forward over several years, working through the complex interactions between revisions, translations, and pagination. The issue remained open from 2016 until 2026 as the community debated the right approach. Alex Pott updated the issue summary to match the final solution and committed the fix across multiple branches. Rafael Payan made their first commit to the issue fork. Multiple reviewers including smustgrave, quietone, and rosk0 tested the changes and pushed for clarity.

## Lessons learned

- When filtering data in memory after fetching from the database, pagination breaks if filtered items exceed the page size. Apply filters directly in database queries so pagination counts reflect actual displayable results. *(via liam morland, acbramley)*
- When loading entities for display, filtering in memory after the query creates confusing user experiences where the 'current' state doesn't match reality. Move filtering logic into queries and surface actual system state, even if it requires additional UI to help users interpret the results. *(via catch, acbramley, quietone)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/2722307) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
