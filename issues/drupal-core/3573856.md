# #3573856: SiteConfigureForm properties need to be reset after module install in submitForm()

- **Project:** Drupal Core
- **Type:** Critical bug report
- **Version:** 11.x-dev
- **Status:** Fixed
- **Diff:** [31b727d](https://git.drupalcode.org/project/drupal/-/commit/31b727dc4f652a986f2b5cf538c24be2da6615c9) · +36/-4 prod · +84/-0 test · 6 files
- **Discussion:** [#3573856](https://www.drupal.org/node/3573856) · 4 contributors · 16 comments

## Summary

When installing Drupal using the Standard or Umami installation profile with the "Check for updates automatically" option enabled, the site configuration form would crash with an error. This happened because installing the Update module triggers a container rebuild, but the form still referenced services from the old container. The fix ensures all service references are refreshed after the Update module is installed, allowing site installation to complete successfully.

## Impact

No upgrade or configuration changes required.

## Technical details

The bug occurred in `SiteConfigureForm::submitForm()` when the `update` module was installed during the site configuration step. Installing a module rebuilds Drupal's service container, but the form object's injected properties like `$entityTypeManager`, `$moduleInstaller`, and `$userNameValidator` still pointed to services from the old container. When the form attempted to load user 1 to populate field values, these stale references caused exceptions.

The fix adds a new `resetPropertiesFromContainer()` method that repopulates all container-dependent properties from the newly rebuilt container. This method is called immediately after `$this->moduleInstaller->install(['update'])` runs. It follows the same pattern as the existing `resetConfigFactory()` method in `FormBase`.

The issue went undetected in existing installer tests because none of them enabled the update module during installation. A new test hook class `TestingSiteConfigHooks` was added to simulate a dependency chain requiring the kernel, and `InstallerSiteConfigProfileTest` was updated to enable the update module, ensuring the fix works correctly.

## Timeline

- Opened: February 16, 2026
- Committed: February 17, 2026

## Collaboration

godotislate opened the issue and developed the fix after smustgrave discovered the bug and nicxvan helped investigate on Slack. godotislate traced why existing tests didn't catch the problem and added test coverage to prevent regressions. nicxvan performed manual testing to verify the fix. catch provided feedback on potential alternative approaches for a follow-up issue.

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3573856) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
