# #3554134: Begin cleaning up system install requirements

- **Project:** Drupal Core
- **Type:** Normal task
- **Version:** 11.x-dev
- **Status:** Fixed
- **Diff:** [e4f6bb4](https://git.drupalcode.org/project/drupal/-/commit/e4f6bb432ce8555e38196020e34ea55aebc501d1) · +3228/-2412 prod · +0/-24 infra · 6 files
- **Discussion:** [#3554134](https://www.drupal.org/node/3554134) · 3 contributors · 26 comments

## Summary

Drupal's system requirements checking code has been refactored to separate installation-time checks from runtime and update checks. Previously, all three phases shared a single large method that used conditional logic to determine which requirements to check. This refactoring splits the code into separate classes, making the codebase more maintainable and reducing code complexity by over 1,000 lines during installation. The cyclomatic complexity of the most complex method in Drupal core dropped significantly, and the separation allows for cleaner future improvements to requirements checking.

## Impact

No upgrade or configuration changes required.

## Technical details

The `SystemRequirements::checkRequirements()` method was copied into `SystemRequirementsHooks` for runtime and update phases, then simplified for each context. The install-time `SystemRequirements` class now only contains checks relevant during installation, removing all runtime and update phase conditional logic. The `SystemRequirementsHooks` class implements `hook_runtime_requirements()` and `hook_update_requirements()`, containing only runtime and update checks without install phase logic.

This separation reduced cyclomatic complexity from 222 to 56 for `SystemRequirements::checkRequirements()`. The `SystemRequirementsHooks::checkRequirements()` method now has complexity 181, but is isolated and can be further refactored in follow-up issues. Several PHPStan baseline entries for undefined variables were removed as dead code paths were eliminated.

The refactoring removes phase-specific checks like experimental module warnings, cron status, configuration file protection, and entity update status from the install phase. Similarly, installation-specific checks like clean URL testing and initial file system setup are removed from runtime and update phases.

## Timeline

- Opened: October 24, 2025
- Committed: February 18, 2026 (3 months later)

## Collaboration

nicxvan authored the issue and refactoring, maintaining the large merge request through multiple rounds of review. dcam provided thorough review by manually comparing the three versions of the requirements code, verifying that phase-specific logic was correctly separated, and conducting manual testing of installation, runtime status reports, and update requirements. catch committed the change despite acknowledged risk from limited test coverage, recognizing the maintainability benefits of reducing the highest cyclomatic complexity in core. Follow-up issues [#3574156](https://www.drupal.org/project/drupal/issues/3574156) and [#3574266](https://www.drupal.org/project/drupal/issues/3574266) were created to continue the refactoring work.

## Lessons learned

- When a method handles multiple runtime phases with conditional logic, splitting it into phase-specific implementations reduces complexity even if total line count stays similar. The separated code becomes maintainable because each implementation can be simplified independently without risking other phases. *(via nicxvan, catch)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3554134) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
