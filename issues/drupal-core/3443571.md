# #3443571: Mobile version of Navigation should have focus trap

- **Project:** Drupal Core
- **Type:** Major bug report
- **Version:** main
- **Status:** Fixed
- **Diff:** [6aaf45e](https://git.drupalcode.org/project/drupal/-/commit/6aaf45efdf88d5d20b544bb153cc963895851f6e) · +72/-2 prod · +616/-6 test · 9 files
- **Discussion:** [#3443571](https://www.drupal.org/node/3443571) · 14 contributors · 91 comments

## Summary

The Navigation module now prevents keyboard users from accidentally focusing on content hidden behind the mobile sidebar. When the sidebar is open on narrow screens, the rest of the page becomes inert so keyboard navigation stays within the visible menu. This fixes an accessibility issue where tabbing through the menu would move focus to elements obscured by the sidebar, violating WCAG 2.4.11 Focus Not Obscured guidelines. The focus trap only applies at mobile widths and removes itself when the sidebar closes or the viewport widens.

## Impact

No upgrade or configuration changes required.

## Technical details

The Navigation module's mobile sidebar now implements a focus trap using the HTML `inert` attribute. When the sidebar opens at widths below 1024px, a new `toggleFocusTrap()` function in `admin-toolbar-wrapper.js` adds the `inert` attribute to all direct children of `body` except the sidebar and overlay. This prevents keyboard and screen reader users from accessing hidden content.

The implementation listens for two events. The sidebar's toggle event calls `toggleFocusTrap()` when opening or closing on mobile. A `matchMedia` listener on the viewport width removes `inert` attributes when resizing to desktop and reapplies them when shrinking back to mobile if the sidebar is open.

Elements with `inert` cannot receive focus, be clicked, or appear in the accessibility tree. The function also adds a `data-admin-toolbar-inert` attribute for tracking which elements were made inert.

Three new Nightwatch tests verify the behavior. The tests check that `inert` attributes are added on mobile when the sidebar opens, removed when it closes, and never applied at desktop widths. The tests also verify that overlay clicks properly close the sidebar and remove the focus trap.

## Timeline

- Opened: April 25, 2024
- Committed: February 18, 2026 (1 year later)

## Collaboration

Mike Herchel opened the issue in April 2024 and drove it through a long accessibility review process. He implemented the `inert`-based solution after exploring alternatives, wrote comprehensive Nightwatch tests using AI assistance, and responded to testing feedback from multiple reviewers over many months.

Kent Richards improved the issue summary, created two followup issues for the close button and ESC key behavior, and kept the scope focused on the core fix. Roland Koller uncovered browser caching issues during testing that initially made the fix appear broken, persisting until the root cause was identified. Catch suggested the cache directory cleanup that resolved Koller's testing problems.

## Lessons learned

- When implementing modal-like UI components that overlay page content, use the `inert` attribute on background elements to prevent keyboard navigation and screen reader access to obscured content. This ensures keyboard focus cannot reach elements hidden behind the overlay, satisfying accessibility requirements without manually trapping tab events or preventing access to browser UI. *(via mherchel, rkoller)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3443571) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
