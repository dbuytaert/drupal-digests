# #3540105: Capture access cacheability in getDefaultOperations() methods for all relevant entity list builders

- **Project:** Drupal Core
- **Type:** Normal bug report
- **Version:** 11.x-dev
- **Status:** Fixed
- **Diff:** [502a59b](https://git.drupalcode.org/project/drupal/-/commit/502a59b2c2b99717e0d59d8e658e084d78773590) · +206/-60 prod · +178/-18 test · 44 files
- **Discussion:** [#3540105](https://www.drupal.org/node/3540105) · 3 contributors · 15 comments

## Summary

Entity list pages show operations like "Edit" and "Delete" for each entity row. These operations depend on access permissions and other dynamic factors. Drupal's cache system needs to know what conditions affect these operations so it can serve cached pages correctly. This fix ensures that when list builders check permissions or other conditions to build their operation links, they properly record those dependencies. Without this fix, cached entity list pages could show incorrect or stale operation links to users.

## Impact

No upgrade or configuration changes required.

## Technical details

A previous issue ([#2473873](https://www.drupal.org/node/2473873)) added support for passing a `CacheableMetadata` object to list builder operation methods so that cacheability information from access checks could be captured. However, many list builder subclasses override `getDefaultOperations()` or `getOperations()` but did not implement the necessary code to retrieve and pass along this optional second parameter.

This fix updates approximately 25 list builder classes across core modules to properly capture the cacheability parameter using `func_get_args()` and pass it to parent method calls. The pattern is consistent across all implementations: extract the `$cacheability` argument from the second position, defaulting to a new `CacheableMetadata` object if not provided, then pass it to `parent::getDefaultOperations()` or `parent::getOperations()`.

Three list builders perform access checks within their `getDefaultOperations()` methods: `FieldConfigListBuilder`, `VocabularyListBuilder`, and `WorkspaceListBuilder`. These now call `access()` with `return_as_object: TRUE` to get an `AccessResultInterface` object, then add it to the `$cacheability` object via `addCacheableDependency()`. This ensures that cache tags, contexts, and max-age from access checks are properly captured.

Test coverage expanded significantly in `EntityOperationsCacheabilityTest` using a data provider to verify correct cacheability capture for entity types including blocks, comments, fields, filters, images, menus, nodes, search pages, shortcuts, taxonomies, users, views, and workspaces.

## Timeline

- Opened: August 6, 2025
- Committed: February 16, 2026 (6 months later)

## Collaboration

godotislate opened this issue as follow-up work from [#2473873](https://www.drupal.org/node/2473873), identifying the gap in cacheability support across list builder subclasses. They prepared the merge request with comprehensive fixes across 25+ list builder classes and significantly expanded test coverage to verify the changes work correctly for most entity types. mxr576 reviewed the changes and confirmed the test-only build failed as expected, validating that the tests properly detect the bug.

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3540105) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
