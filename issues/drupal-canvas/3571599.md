# #3571599: "Template for Basic page not found" error after adding new template

- **Project:** Drupal Canvas
- **Type:** Normal bug report
- **Version:** 1.x-dev
- **Status:** Fixed
- **Diff:** [d1e6d28](https://git.drupalcode.org/project/canvas/-/commit/d1e6d28b27dae3f9e5c6a10161aa7f2da04d8ed7) · +266/-16 prod · +226/-0 test · 11 files
- **Discussion:** [#3571599](https://www.drupal.org/node/3571599) · 4 contributors · 15 comments

## Summary

When adding a new content template through the Canvas editor interface, users saw an error message "Template for Basic page not found" immediately after submission. The correct message ("No preview content is available" with a link to add content) only appeared after manually refreshing the page. This bug made the template creation workflow feel broken, even though the template was actually created successfully. The fix ensures the interface updates correctly right away without requiring a refresh.

## Impact

No upgrade or configuration changes required.

## Technical details

The bug occurred in the `TemplateRoot` component's template validation logic. When a new template was added via the dialog, the component checked whether a view mode existed in the templates data and set `showNoTemplateError` to true if missing. However, the logic only set the error state when no template was found, without explicitly clearing it when a template did exist.

After adding a template through the dialog, the templates data would update to include the new view mode. But because the error state was never reset to false in the success path, the stale error remained visible until a full page refresh reconstructed the component state.

The fix adds an `else` branch to explicitly call `setShowNoTemplateError(false)` when `viewModeData` exists, ensuring the error state is cleared immediately when the templates data updates.

The patch also improves the template editor's navigation utilities. The new `setTemplatePreviewEntityId()` function and supporting `setPreviewEntityIdInPathname()` utility allow changing the preview entity without reconstructing the entire route. The `ContentPreviewSelector` component now uses this focused navigation approach instead of calling the heavier `navigateToTemplateEditor()` function, preventing unnecessary route changes that could trigger state bugs.

Additional changes include comprehensive end-to-end tests for template creation workflows, accessibility improvements to the `PropLinker` component (converting from a span to a semantic button element with proper ARIA labels), and test identifiers added to several components to support automated testing.

## Timeline

- Opened: February 4, 2026
- Committed: February 12, 2026 (8 days later)

## Collaboration

hooroomoo made their first contribution to Canvas with this fix, identifying the state management issue and implementing both the bug fix and comprehensive test coverage. Wim Leers provided review feedback noting that data attributes added for testing should be minimal and purposeful. tedbow opened the issue and traced it back to changes from a previous seamless navigation feature.

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3571599) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
