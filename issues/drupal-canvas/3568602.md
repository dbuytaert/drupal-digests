# #3568602: Handle upgrading and rendering not yet upgraded component instances of components with new(ly) required props that include an example value

- **Project:** Drupal Canvas
- **Type:** Normal feature request
- **Version:** 1.x-dev
- **Status:** Fixed
- **Diff:** [292c45e](https://git.drupalcode.org/project/canvas/-/commit/292c45ed8b6b4cd5a43080f94d2c8e34e294c02a) · +97/-46 prod · +274/-53 test · 16 files
- **Discussion:** [#3568602](https://www.drupal.org/node/3568602) · 5 contributors · 23 comments

## Summary

When a component adds a new required prop or changes an existing prop from optional to required, Canvas now automatically populates the prop with its example value. This happens both when editing a page that contains the component (the component instance upgrades automatically) and when rendering pages that haven't been edited yet (the missing prop is added at render time). This ensures that published pages continue to work immediately after a component evolves, without requiring manual updates to every page.

## Impact

No upgrade or configuration changes required.

## Technical details

This change extends the automatic component instance upgrade system introduced in [#3567413](https://www.drupal.org/node/3567413) to handle new required props.

When `GeneratedFieldExplicitInputUxComponentInstanceUpdater::update()` upgrades a component instance, it now detects when the active version has required props that are either new or were previously optional. For new required props, it adds the `default_value` from `prop_field_definitions` (which comes from the first example in the JSON schema). For props that changed from optional to required, it only adds the default if no input already exists, preserving user-provided values.

At render time, `ComponentTreeItemList::getHydratedTree()` now calls `getDefaultExplicitInput(only_required: TRUE)` on the active version's component source to get required props with default values. It passes these to `hydrateComponent()` via a new `$active_required_explicit_inputs` parameter. The `GeneratedFieldExplicitInputUxComponentSourceBase::hydrateComponent()` method merges these defaults after filtering out removed props, ensuring the live component implementation receives all required props even when rendering component instances that reference older versions.

The `ComponentSourceInterface::getDefaultExplicitInput()` method now accepts an `$only_required` parameter to return only required inputs. The `ComponentSourceInterface::hydrateComponent()` signature adds the `$active_required_explicit_inputs` parameter. The docs now correctly categorize adding required props and changing props to required as safe auto-update cases rather than unsafe ones.

## Timeline

- Opened: January 20, 2026
- Committed: February 18, 2026 (29 days later)

## Collaboration

effulgentsia opened this issue as a follow-up to establish the design for handling newly required props, building on the auto-upgrade foundation. Wim Leers connected this work to earlier discussions about component evolution from April 2024 and pushed for clarity around the baseline assumption that required props must have example values. mglaman implemented the solution with careful attention to both the upgrade path and render-time hydration, then identified that test failures revealed a separate prop validation issue that was split into [#3574120](https://www.drupal.org/node/3574120). penyaskito reviewed the render logic and suggested refactoring opportunities to keep the codebase maintainable.

## Lessons learned

- When a component schema adds a required prop with an example value, existing instances can be rendered by merging the example value as a default before evaluation. This allows components to evolve without breaking already-published content that hasn't been edited yet. *(via effulgentsia)*
- When a plugin's configuration schema changes, handle two separate upgrade paths: eager upgrade when the configuration is next edited, and lazy upgrade when rendering unmodified configurations. This allows published content to continue working while deferring data migration until editing occurs. *(via effulgentsia)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3568602) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
