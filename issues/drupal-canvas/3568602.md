# #3568602: Handle upgrading and rendering not yet upgraded component instances of components with new(ly) required props that include an example value

- **Project:** Drupal Canvas
- **Type:** Normal feature request
- **Version:** 1.x-dev
- **Status:** Fixed
- **Diff:** [ac202d3](https://git.drupalcode.org/project/canvas/-/commit/ac202d3eaf5c31cc48823381679f7ae4938f5da8) · +101/-46 prod · +286/-59 test · 21 files
- **Discussion:** [#3568602](https://www.drupal.org/node/3568602) · 5 contributors · 31 comments

## Summary

Canvas now automatically handles component evolution when components add new required properties or change existing properties from optional to required. When a component is updated to require new data fields, existing pages and templates using that component will render with the example values defined in the component's schema. When editors open those pages, Canvas upgrades the component instances automatically, preserving any existing user-provided values while populating new required fields with their defaults. This allows component developers to evolve their designs without breaking published content.

## Impact

No upgrade or configuration changes required.

## Technical details

This feature extends the automatic component instance upgrading system introduced in [#3567413](https://www.drupal.org/node/3567413) to handle two additional evolution scenarios: when a component adds a new required prop with an example value, and when an existing optional prop becomes required.

Canvas assumes every required prop has at least one example value, enforced by `ComponentMetadataRequirementsChecker`. When a component evolves, the first example value becomes the `default_value` in the Component entity's `prop_field_definitions`.

The implementation operates in two contexts. At edit time, `GeneratedFieldExplicitInputUxComponentInstanceUpdater::update()` now populates new required props with their default values when upgrading component instances. For optional-to-required transitions, it preserves existing user-provided values and only adds defaults when no value was stored. At render time, `ComponentTreeItemList::getHydratedTree()` ensures not-yet-upgraded component instances can render by calling `ComponentSourceInterface::hydrateComponent()` with a new `$active_required_explicit_inputs` parameter containing the default values for all required props in the active version.

The `ComponentSourceInterface::getDefaultExplicitInput()` method now accepts an `$only_required` parameter to retrieve only required inputs. The `hydrateComponent()` method signature adds `$active_required_explicit_inputs` to provide defaults at render time. These changes apply to all component sources including `JsComponent`, `SingleDirectoryComponent`, and `BlockComponent`.

## Timeline

- Opened: January 20, 2026
- Committed: February 18, 2026 (29 days later)

## Collaboration

effulgentsia designed the approach and opened the issue, building on the foundation laid in [#3567413](https://www.drupal.org/node/3567413). mglaman implemented the core logic for both edit-time upgrades and render-time hydration, including extensive test coverage that validates the behavior across multiple evolution scenarios. penyaskito reviewed the implementation and helped refactor the render logic. Wim Leers provided detailed code review, catching incorrect comments and ensuring the implementation remained clear for future iteration. The team split out related validation concerns to [#3574120](https://www.drupal.org/node/3574120) to keep this focused on the automatic upgrade behavior.

## Lessons learned

- When rendering component instances that reference older versions of a component definition, apply defaults from the active definition at render time rather than blocking rendering. This allows published content to continue rendering after non-breaking component changes, with the instance data upgraded to the new version when explicitly edited. *(via effulgentsia, lauriii, wim leers, mglaman, penyaskito)*
- When a plugin or component definition adds a new required property, guarantee that a safe default exists (such as an example value in the schema). This ensures that existing stored instances can continue to function without migration when the new property is added at render time. *(via effulgentsia, wim leers)*

---

*This summary is AI-generated and may contain errors. Check the [original issue on Drupal.org](https://www.drupal.org/node/3568602) for the full picture. For more digests, see [Drupal Digests](https://github.com/dbuytaert/drupal-digests/).*
